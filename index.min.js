//// version:1.0        author:sunzq        Email:zengqiang365@163.com
var airView=initViewer("#cesiumContainer","http://112.90.177.72:8500","http://112.90.177.72:8501/?",{satelliteMapUrl:"http://112.90.177.72:8500/maps/satellite/{z}/{x}/{y}.png",defaultLonEnt:119,defaultLatEnt:100,realHeight:!0});airView.setFocus(119,40,1E7);airView.start();setTimeBar();var filterArray=["#lat","#long","#height","#ansi"];function buildFilters(a){a.forEach(function(a){$(a).slider({tooltip:"always",tooltip_position:"bottom"}).on("slide slideStop",function(a){airView.setShowRange({latRange:$("#lat").val().split(","),lonRange:$("#long").val().split(","),heightRange:$("#height").val().split(","),valRange:$("#ansi").val().split(",")})})})}buildFilters(filterArray);$("[name\x3dpollutRadios]").on("click",function(){airView.setOverlay(this.value);var a=airView.getOverlay().valueRange;$("#ansi").slider("destroy");$("#ansi").slider({min:a.min,max:a.max,step:a.step,value:a.value,tooltip:"always",tooltip_position:"bottom"});$("#ansi").on("slide",function(a){airView.setShowRange({latRange:$("#lat").val().split(","),lonRange:$("#long").val().split(","),heightRange:$("#height").val().split(","),valRange:$("#ansi").val().split(",")})});airView.reloadData();reBuildImage()});$("[name\x3d'pblhcheck']").on("click",function(){$("input[name\x3d'pblhcheck']").is(":checked")?airView.showPBLH():airView.hidePBLH()});function setTimeBar(){var a=airView.getConfig();$("#timeLabel").html(a.time.utc().format("YYYY-MM-DD HH:mm:ss")+" UTC");$("#verContentLable").html(a.time.utc().format("YYYY-MM-DD HH:mm:ss")+" UTC "+a.overlayType)}function setConfigTime(a){airView.setDate(a);setTimeBar();reBuildImage()}$("#nav-forward").click(function(a){a.preventDefault();setConfigTime(1)});$("#nav-forward-more").on("click",function(a){a.preventDefault();setConfigTime(24)});$("#nav-backward").on("click",function(a){a.preventDefault();setConfigTime(-1)});$("#nav-backward-more").on("click",function(a){a.preventDefault();setConfigTime(-24)});function initColorBar(){var a=colortable.getColors();a.unshift("\u6807\u51c6");d3.select("#colorArray").selectAll("option").data(a).enter().append("option").text(function(a){return a});var a=.175*document.body.offsetWidth,b=d3.select("#colorbar").append("canvas").attr("width",a).attr("height",20);airView.renderColorScale($("#colorArray option:selected").val(),b);$("#colorArray").change(function(){airView.renderColorScale($("#colorArray option:selected").val(),b);airView.recolor()})}initColorBar();$("#selectMap").change(function(){airView.changeMap($("#selectMap option:selected").val())});$("#selectLayer").change(function(){airView.changeLayer($("#selectLayer option:selected").val())});var monitorMode=!1;d3.select("#showToolBar").style("background","#48b").style("border-color","#aef");$("#showToolBar").click(function(){monitorMode&&(airView.disableMonitor(),$("#selectMap").val("streetMap"),$("#selectMap").show(),$("#selectLayer").hide(),d3.select("#showToolBar").style("background","#48b").style("border-color","#aef"),d3.select("#showMonitor").style("background","#303336").style("border-color","#444"),monitorMode=!1);$("#toolbar").fadeToggle("fast")});$("#hideToolBar").click(function(){$("#toolbar").hide()});$("#showMonitor").click(function(){monitorMode||($("#toolbar").hide(),airView.enableMonitor(),hideVertical(),$("#selectMap").hide(),$("#selectLayer").show(),d3.select("#showMonitor").style("background","#48b").style("border-color","#aef"),d3.select("#showToolBar").style("background","#303336").style("border-color","#444"),monitorMode=!0)});var longslider,latslider;function buildVlonSlider(){longslider=$("#vertical-long").slider({tooltip:"always",tooltip_position:"bottom"});longslider.on("slideStop",function(a){a=$("#vertical-long").val();airView.setLonEntPosition(a);$("#longImage").attr("href",airView.buildImagePath("lon",a))})}buildVlonSlider();function buildVlatSlider(){latslider=$("#vertical-lat").slider({tooltip:"always",tooltip_position:"bottom"});latslider.on("slideStop",function(a){a=$("#vertical-lat").val();airView.setLatEntPosition(a);$("#latImage").attr("href",airView.buildImagePath("lat",a))})}buildVlatSlider();$("[name\x3dvhRadios]").on("click",function(){var a=this.value;$("#horiImage").attr("href",airView.buildImagePath("h",a))});$(".tab-btn").click(function(){$(".tab-btn").removeClass("btn-primary");$(this).addClass("btn-primary");"vertical"==$("input[name\x3d'taboptions']:checked").attr("id")?($("#form-filter").attr("style","display:block"),$("#form-vertical").attr("style","display:none"),hideVertical()):($("#form-filter").attr("style","display:none"),$("#form-vertical").attr("style","display:block"),showVertical())});function hideVertical(){$("#charts").attr("style","display:none");airView.setVerticalHide()}function showVertical(){$("#charts").attr("style","display:block");airView.setVerticalShow()}var chartArray=[{id:"#chart1",imageID:"horiImage",name:"\u6c34\u5e73\u5256\u9762\u56fe",vtype:"h",initNum:"100m"},{id:"#chart2",imageID:"longImage",name:"\u7ecf\u5411\u5782\u76f4\u5256\u9762\u56fe",vtype:"lon",initNum:"119"},{id:"#chart3",imageID:"latImage",name:"\u7eac\u5411\u5782\u76f4\u5256\u9762\u56fe",vtype:"lat",initNum:"100"}];function initProfile(){var a=.6*document.body.offsetWidth,b=a-19.5,c=.75*window.screen.availHeight-19.5,e=.2*a+20;chartArray.forEach(function(a,f){var d=d3.select(a.id).style({"margin-left":e*f+"px"}).append("svg").attr("width",b+19.5+19.5).attr("height",c+19.5+19.5);d.append("text").attr("class","year clabel").attr("y",39).attr("x",b/3).text(a.name);d.append("g").attr("transform","translate(0,58.5)").append("image").attr("id",a.imageID).attr("xlink:href",airView.buildImagePath(a.vtype,a.initNum)).attr("x","0").attr("y","0").attr("height","100%").attr("width","100%");d3.selectAll(".profile").style({opacity:"0.8",filter:"alpha(opacity\x3d80)","-moz-opacity":"0.8","-khtml-opacity":"0.8"}).on("mouseover",function(a){d3.selectAll(".profile").style({opacity:"0.05",filter:"alpha(opacity\x3d5)","-moz-opacity":"0.05","-khtml-opacity":"0.05"});d3.select(this).style({opacity:"1.0",filter:"alpha(opacity\x3d100)","-moz-opacity":"1.0","-khtml-opacity":"1.0"})}).on("mouseout",function(a){d3.selectAll(".profile").style({opacity:"0.8",filter:"alpha(opacity\x3d80)","-moz-opacity":"0.8","-khtml-opacity":"0.8"})})})}initProfile();function reBuildImage(){var a=$("#vertical-long").val(),b=$("#vertical-lat").val(),c=$("input[name\x3d'vhRadios']:checked").val();$("#longImage").attr("href",airView.buildImagePath("lon",a));$("#latImage").attr("href",airView.buildImagePath("lat",b));$("#horiImage").attr("href",airView.buildImagePath("h",c))};